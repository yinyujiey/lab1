name: 第一个 CI/CD 管道

# 触发条件：推送到 main 或 master 分支时触发
on:
  push:
    branches: ["main", "master"]
  workflow_dispatch: # 允许手动点击按钮触发

jobs:
  # 1. 构建作业
  build-job:
    runs-on: ubuntu-latest # 指定运行环境
    steps:
      - name: 运行构建脚本
        # ${{ github.actor }} 是 GitHub 的上下文变量
        run: echo "你好，${{ github.actor }}！"

  # 2. 测试作业 1
  test-job1:
    needs: build-job # 依赖 build-job，确保顺序执行
    runs-on: ubuntu-latest
    steps:
      - name: 运行测试脚本
        run: echo "此作业测试某些内容"

  # 3. 测试作业 2 (这里是你之前报错的地方)
  test-job2:
    needs: build-job # 同样依赖 build-job，将与 test-job1 并行运行
    runs-on: ubuntu-latest
    steps:
      - name: 运行更长的测试脚本
        # 使用 | 符号表示多行命令，下一行必须缩进
        run: |
          echo "这项任务测试某些内容，但比 test-job1 花费更多时间。"
          echo "这模拟了一个比测试作业1运行时间长20秒的测试"
          sleep 20

  # 4. 部署作业
  deploy-prod:
    needs: [test-job1, test-job2] # 只有当两个测试作业都成功后才运行
    runs-on: ubuntu-latest
    environment: 生产 # GitHub 的环境名称
    steps:
      - name: 部署脚本
        # ${{ github.ref_name }} 对应分支名称
        run: echo "此作业会从 ${{ github.ref_name }} 分支部署某些内容。"
